<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AI Analyzer | KickStart</title>
    <link rel="icon" type="image/x-icon" href="favicon.png" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="navbar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body {
            background: #f6f7fb;
            margin: 0;
            padding: 0;
        }
        .ai-analyzer-section {
            margin-top: 8rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 80vh;
        }
        .ai-analyzer-card {
            background: #fff;
            border-radius: 1.5rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.13);
            padding: 2.5rem 2.5rem 2rem 2.5rem;
            max-width: 420px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 2rem;
        }
        .ai-analyzer-card h1 {
            font-size: 2rem;
            font-weight: 900;
            color: #181818;
            margin-bottom: 1rem;
            text-align: center;
        }
        .ai-analyzer-card p {
            font-size: 1.1rem;
            color: #222;
            margin-bottom: 2rem;
            text-align: center;
        }
        .ai-analyzer-btn {
            background: #ff6600;
            color: #fff;
            padding: 0.8rem 2.2rem;
            font-size: 1.08rem;
            font-weight: 700;
            border-radius: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            transition: background 0.2s,transform 0.2s;
            border: none;
            text-decoration: none;
            margin-top: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.7rem;
        }
        .ai-analyzer-btn:hover, .ai-analyzer-btn:focus {
            background: #181818;
            color: #fff;
            transform: scale(1.06);
        }
        #ai-video-modal {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        #ai-video-modal-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #fff;
            border-radius: 1.2rem;
            padding: 2rem;
            box-shadow: 0 4px 32px rgba(0,0,0,0.25);
            position: relative;
        }
        #ai-video-modal video {
            border-radius: 1.2rem;
            box-shadow: 0 4px 32px rgba(0,0,0,0.15);
            width: 350px;
            height: 350px;
            background: #000;
        }
        #ai-video-modal .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: #ff6600;
            color: #fff;
            border: none;
            border-radius: 2rem;
            padding: 0.5rem 1.2rem;
            font-weight: 700;
            cursor: pointer;
        }
        #ai-video-modal .close-btn:hover {
            background: #181818;
        }
        @media (max-width: 600px) {
            .ai-analyzer-card {
                padding: 1.2rem;
            }
            #ai-video-modal video {
                width: 90vw;
                height: 50vw;
                min-width: 180px;
                min-height: 180px;
            }
        }
        @media (max-width: 900px) {
            .hero-nav {
                height: 48px;
            }
            .hero-nav .logo {
                font-size: 1.1rem;
                margin-right: 12px;
            }
            #nav-menu {
                gap: 10px;
            }
            #nav-menu li a {
                font-size: 0.95rem;
                padding-bottom: 2px;
            }
        }
    </style>
</head>
<body>
     <nav class="hero-nav navbar-collapsed" role="navigation" aria-label="Primary navigation">
                <div class="logo" aria-label="KickStart logo">KickStart</div>
<ul id="nav-menu">
                    <li><a href="index.html" aria-current="page"><i class="fas fa-home"></i><span class="nav-text">Home</span></a></li>
                    <li><a href="shop.html"><i class="fas fa-store"></i><span class="nav-text">Shop</span></a></li>
                    <li><a href="collections.html"><i class="fas fa-th-large"></i><span class="nav-text">Collections</span></a></li>
                    <li class="dropdown">
                        <a href="#" aria-haspopup="true" aria-expanded="false"><i class="fas fa-shoe-prints"></i><span class="nav-text">AI</span> <i class="fas fa-caret-down"></i></a>
                        <ul class="dropdown-menu" aria-label="submenu">
                            <li><a href="ai-analyzer.html">AI Analyzer</a></li>
                            <li><a href="ai-style-recommender.html">AI Style Recommender</a></li>
                        </ul>
                    </li>
                    <li><a href="about.html"><i class="fas fa-info-circle"></i><span class="nav-text">About</span></a></li>
                    <li><a href="login.html" id="login-link"><i class="fas fa-user"></i><span class="nav-text">Login</span></a></li>
<li><a href="cart.html"><i class="fas fa-shopping-cart"></i><span class="nav-text">Cart</span> <span id="cart-count" style="background:#ff6600; color:#fff; border-radius:50%; padding:0 7px; font-size:0.8rem; font-weight:bold; vertical-align:top; margin-left:4px;">0</span></a></li>
                </ul>
            </nav>
    <main>
        <section class="ai-analyzer-section">
            <div class="ai-analyzer-card">
                <h1>AI Shoe Fit Analyzer</h1>
                <p>
                    Try our AR-powered shoe fit analyzer!<br>
                    Click the button below to open your camera and see how our shoes fit your foot in real time.
                </p>
                <button class="ai-analyzer-btn" id="open-ai-analyzer">
                    <i class="fas fa-camera"></i> Try AR Shoe Fit
                </button>
            </div>
        </section>
    </main>
    <footer>
        <p>&copy; 2025 KickStart. All rights reserved.</p>
    </footer>
    <script>
    // Modal HTML for custom alert
    const modalHTML = `
    <div id="customAlertModal" class="custom-modal" style="display:none;">
        <div class="custom-modal-content">
            <span class="custom-close-btn" id="customAlertClose">&times;</span>
            <p id="customAlertMessage"></p>
        </div>
    </div>
    `;

    // Append modal HTML to body and setup modal functionality
    document.addEventListener('DOMContentLoaded', () => {
        document.body.insertAdjacentHTML('beforeend', modalHTML);

        const modal = document.getElementById('customAlertModal');
        const closeBtn = document.getElementById('customAlertClose');
        const messagePara = document.getElementById('customAlertMessage');

        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Expose showMessage globally
        window.showMessage = function(message) {
            messagePara.textContent = message;
            modal.style.display = 'flex';
        };
    });

    document.getElementById('open-ai-analyzer').onclick = function() {
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function(stream) {
                    // Modal
                    let modal = document.createElement('div');
                    modal.id = 'ai-video-modal';

                    let content = document.createElement('div');
                    content.id = 'ai-video-modal-content';

                    let video = document.createElement('video');
                    video.autoplay = true;
                    video.srcObject = stream;

                    let info = document.createElement('div');
                    info.textContent = "Point your camera at your foot to try AR shoe fitting!";
                    info.style.color = "#181818";
                    info.style.marginBottom = "1rem";
                    info.style.fontSize = "1.1rem";
                    info.style.textAlign = "center";
                    info.style.fontWeight = "600";

                    let closeBtn = document.createElement('button');
                    closeBtn.textContent = 'Close';
                    closeBtn.className = 'close-btn';
                    closeBtn.onclick = function() {
                        stream.getTracks().forEach(track => track.stop());
                        document.body.removeChild(modal);
                    };

                    content.appendChild(info);
                    content.appendChild(video);
                    content.appendChild(closeBtn);
                    modal.appendChild(content);
                    document.body.appendChild(modal);
                })
                .catch(function() {
                    showMessage('Camera access denied or not available.');
                });
        } else {
            showMessage('Camera not supported on this device.');
        }
    };
    </script>
    <!-- MediaPipe Libraries -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>

<script>
    let pose;
    let canvas, canvasCtx, resultText;

    document.getElementById('open-ai-analyzer').onclick = function () {
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function (stream) {
                    // Modal setup
                    let modal = document.createElement('div');
                    modal.id = 'ai-video-modal';

                    let content = document.createElement('div');
                    content.id = 'ai-video-modal-content';

                    let video = document.createElement('video');
                    video.id = 'analyzer-video';
                    video.autoplay = true;
                    video.playsInline = true;
                    video.srcObject = stream;

                    resultText = document.createElement('p');
                    resultText.id = 'measurement-result';
                    resultText.style.margin = '1rem 0';
                    resultText.style.fontWeight = '600';
                    resultText.style.color = '#181818';
                    resultText.textContent = "Measuring...";

                    canvas = document.createElement('canvas');
                    canvas.id = 'analyzer-canvas';
                    canvas.width = 350;
                    canvas.height = 350;
                    canvas.style.position = 'absolute';
                    canvas.style.top = '0';
                    canvas.style.left = '0';

                    let canvasWrapper = document.createElement('div');
                    canvasWrapper.style.position = 'relative';
                    canvasWrapper.appendChild(video);
                    canvasWrapper.appendChild(canvas);

                    let closeBtn = document.createElement('button');
                    closeBtn.textContent = 'Close';
                    closeBtn.className = 'close-btn';
                    closeBtn.onclick = function () {
                        stream.getTracks().forEach(track => track.stop());
                        document.body.removeChild(modal);
                    };

                    content.appendChild(resultText);
                    content.appendChild(canvasWrapper);
                    content.appendChild(closeBtn);
                    modal.appendChild(content);
                    document.body.appendChild(modal);

                    runPoseModel(video);
                })
                .catch(function () {
                    alert('Camera access denied or not available.');
                });
        } else {
            alert('Camera not supported on this device.');
        }
    };

    function runPoseModel(video) {
        canvasCtx = document.getElementById('analyzer-canvas').getContext('2d');

        pose = new Pose({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
        });

        pose.setOptions({
            modelComplexity: 1,
            smoothLandmarks: true,
            enableSegmentation: false,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });

        pose.onResults(onPoseResults);

        const camera = new Camera(video, {
            onFrame: async () => {
                await pose.send({ image: video });
            },
            width: 350,
            height: 350
        });

        camera.start();
    }

    function onPoseResults(results) {
    canvasCtx.save();
    canvasCtx.clearRect(0, 0, canvas.width, canvas.height);
    canvasCtx.drawImage(results.image, 0, 0, canvas.width, canvas.height);

    if (results.poseLandmarks) {
        drawConnectors(canvasCtx, results.poseLandmarks, POSE_CONNECTIONS, { color: '#FF6600' });

        const landmarks = results.poseLandmarks;
        const heel = landmarks[29];  // Left Heel
        const toe = landmarks[31];   // Left Big Toe

        // OPTIONAL: simulate card detection (replace with real logic later)
        const card_pixel_width = 120;  // ⬅️ You can manually measure this using dev tools or write logic to detect a rectangle

        const card_real_width_cm = 8.56;
        const pixels_per_cm = card_pixel_width / card_real_width_cm;

        if (heel && toe) {
            const dx = (heel.x - toe.x) * canvas.width;
            const dy = (heel.y - toe.y) * canvas.height;
            const pixelDistance = Math.sqrt(dx * dx + dy * dy);

            const length_cm = pixelDistance / pixels_per_cm;
            const length_in = length_cm / 2.54;

            resultText.innerHTML = `
                <strong>Foot Length:</strong><br>
                ${pixelDistance.toFixed(1)} px<br>
                ${length_cm.toFixed(2)} cm<br>
                ${length_in.toFixed(2)} inches
            `;
        }
    }
    canvasCtx.restore();
}
canvasCtx.strokeStyle = '#00bcd4';
canvasCtx.lineWidth = 2;
canvasCtx.strokeRect(20, canvas.height - 60, 120, 20); // card guide
canvasCtx.fillStyle = '#00bcd4';
canvasCtx.fillText('Place card here', 25, canvas.height - 65);
const card_pixel_width = 220;  // for example
const card_real_width_cm = 8.56;
const pixels_per_cm = card_pixel_width / card_real_width_cm;
document.getElementById('measurement-result').textContent = "Point your camera at your foot to measure length!";    
</script>
<script>
    function updateCartCount() {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let count = cart.reduce((sum, item) => sum + (item.qty || 1), 0);
        const badge = document.getElementById('cart-count');
        if (badge) {
            badge.textContent = count;
            console.log("Cart count updated to:", count);
        }
    }
    document.addEventListener('DOMContentLoaded', function() {
        updateCartCount();
    });
</script>
</body>
</html>
